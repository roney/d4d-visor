<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
    font: 10px Helvetica Neue;
    fill: #666;
}

.axis path,
.axis line {
    fill: #666;
    stroke: #666;
    shape-rendering: crispEdges;
}

/*.bar {
    fill: #BFD3E6;
}*/

.x.axis path {
    display: none;
}

</style>
<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script>

    var margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = 300 - margin.left - margin.right,
        height = 100 - margin.top - margin.bottom;

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .tickValues([0,2,4,6,8,10,12,14,16,18,20,22])
        .tickFormat(function(t) { return (t == 12 || t == 0) ? 12 : t % 12; })
        .orient("bottom");

    var svg = d3.select("body").insert("svg:svg", "form")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("svg:g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    var chart = svg.append("svg:g")
        .attr("class", "bar");

    var axis = svg.append("svg:g")
        .attr("class", "x axis")

    var day = 0;

    queue()
        .defer(d3.csv, "data2.csv")
        .await(ready);

    function ready(error, data) {
        var array = [];
        for (var key in data[day]) { array.push(data[day][key]); }
            array.forEach(function(d) { d = +d; });

        x.domain(array.map(function(d, i) { return i; }));
        y.domain([0, d3.max(array, function(d) { return d; })]);

        axis.attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        chart.selectAll(".bar")
            .data(array)
            .enter().append("rect")
            .attr("fill", function(d, i) {
                    return (i < 12) ? "#BFD3E6" : "#49006A" })
            .attr("x", function(d, i) { return x(i); })
            .attr("width", x.rangeBand())
            .attr("y", function(d) { return y(d); })
            .attr("height", function(d) { return height - y(d); });

        window.focus();
        d3.select(window).on("keydown", function() {
            switch (d3.event.keyCode) {
              case 38: day = increase_day(day); break;
              case 40: day = decrease_day(day); break;
            }
            redraw();
        });

        function redraw() {
            var array = [];
            for (var key in data[day]) { array.push(data[day][key]); }
            array.forEach(function(d) { d = +d; });

            chart.selectAll("rect")
                .data(array)
                .attr("fill", function(d, i) {
                    return (i < 12) ? "#BFD3E6" : "#49006A" })
                .transition()
                .duration(750)
                .attr("y", function(d) { return y(d); })
                .attr("height", function(d) { return height -  y(d); });
        }
    }

    function increase_day(current) {
        return (current != 6) ? Math.min(6, current + 1) : 0;
    }
    function decrease_day(current) {
        return (current != 0) ? Math.max(0, current - 1) : 6;
    }

    </script>
